# æ»‘å—éªŒè¯ç è½¨è¿¹ç”Ÿæˆå™¨ (Slider Captcha Trajectory Generator)

åŸºäº LLMï¼ˆQwen2.5-0.5Bï¼‰å¾®è°ƒçš„æ»‘å—éªŒè¯ç è½¨è¿¹ç”Ÿæˆå·¥å…·ã€‚é€šè¿‡æ·±åº¦å­¦ä¹ æ¨¡å‹ç”Ÿæˆç¬¦åˆäººç±»è¡Œä¸ºç‰¹å¾çš„æ»‘å—ç§»åŠ¨è½¨è¿¹ã€‚

## ğŸ“¸ æ•ˆæœæ¼”ç¤º

### ç”Ÿæˆè½¨è¿¹ç¤ºä¾‹

![è½¨è¿¹ç”Ÿæˆç¤ºä¾‹](img/img.png)

### éªŒè¯ç ç¤ºä¾‹

![éªŒè¯ç ç¤ºä¾‹](img/20251211_194429_2.png)

## âœ¨ ç‰¹æ€§

- ğŸ¤– åŸºäºé˜¿é‡Œé€šä¹‰åƒé—® Qwen2.5-0.5B-Instruct æ¨¡å‹å¾®è°ƒ
- ğŸ¯ ä½¿ç”¨ LoRA æŠ€æœ¯è¿›è¡Œé«˜æ•ˆå¾®è°ƒ
- ğŸ“Š ç”Ÿæˆç¬¦åˆäººç±»è¡Œä¸ºç‰¹å¾çš„è‡ªç„¶è½¨è¿¹
- ğŸš€ æ”¯æŒè‡ªå®šä¹‰ç›®æ ‡è·ç¦»å’Œç”»å¸ƒé•¿åº¦
- ğŸ› ï¸ å†…ç½®å¯è§†åŒ–å·¥å…·ï¼Œæ–¹ä¾¿æµ‹è¯•å’Œè°ƒè¯•
- âš¡ æ”¯æŒ CUDAã€MPSï¼ˆApple Siliconï¼‰å’Œ CPU å¤šç§è¿è¡Œç¯å¢ƒ

## ğŸ“‹ é¡¹ç›®ç»“æ„

```
slider_captcha_trajectory_gen/
â”œâ”€â”€ llm_generator.py           # è½¨è¿¹ç”Ÿæˆå™¨ï¼ˆæ¨ç†ï¼‰
â”œâ”€â”€ train_lora.py              # LoRA å¾®è°ƒè„šæœ¬
â”œâ”€â”€ download_model.py          # æ¨¡å‹è‡ªåŠ¨ä¸‹è½½è„šæœ¬
â”œâ”€â”€ convert_to_jsonl.py        # æ•°æ®è½¬æ¢è„šæœ¬
â”œâ”€â”€ training_data.jsonl        # è®­ç»ƒæ•°æ®é›†ï¼ˆJSONLæ ¼å¼ï¼‰
â”œâ”€â”€ requirements.txt           # Python ä¾èµ–
â”œâ”€â”€ models/                    # æ¨¡å‹ä¿å­˜ç›®å½•
â”‚   â””â”€â”€ final_model/          # å¾®è°ƒåçš„æœ€ç»ˆæ¨¡å‹
â”œâ”€â”€ tools/                     # å·¥å…·é›†
â”‚   â””â”€â”€ slider-tool.html      # å¯è§†åŒ–æµ‹è¯•å·¥å…·
â”œâ”€â”€ img/                       # ç¤ºä¾‹å›¾ç‰‡
â””â”€â”€ captcha_annotator_flutter/ # Flutter æ ‡æ³¨å·¥å…·
    â”œâ”€â”€ lib/                  # æ ‡æ³¨å·¥å…·æºç 
    â”œâ”€â”€ V2_DATASET_ANNOTATION.md  # V2æ ‡æ³¨æŒ‡å—
    â””â”€â”€ ...

captcha_dataset/               # éªŒè¯ç æ•°æ®é›†ï¼ˆçˆ¶çº§ç›®å½•ï¼‰
â”œâ”€â”€ images/                    # éªŒè¯ç å›¾ç‰‡
â”‚   â”œâ”€â”€ {id}_big.png          # èƒŒæ™¯å¤§å›¾
â”‚   â””â”€â”€ {id}_small.png        # æ»‘å—å°å›¾
â””â”€â”€ metadata/                  # æ ‡æ³¨æ•°æ®ï¼ˆJSONæ ¼å¼ï¼‰
    â””â”€â”€ {id}.json             # åŸºæœ¬ä¿¡æ¯æ–‡ä»¶ï¼ˆæ•°æ®æ”¶é›†å·¥å…·åˆ›å»ºï¼‰
                               # æ ‡æ³¨åä¼šè‡ªåŠ¨æ·»åŠ  tracks å­—æ®µ
```

## ğŸ”§ ç¯å¢ƒè¦æ±‚

- Python 3.8+
- PyTorch 2.0+
- CUDA 11.8+ (å¯é€‰ï¼Œç”¨äº GPU åŠ é€Ÿ)
- 8GB+ RAM (æ¨è 16GB+)

## ğŸ“¦ å®‰è£…

### 1. å…‹éš†é¡¹ç›®

```bash
git clone <repository-url>
cd slider_captcha_trajectory_gen
```

### 2. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 3. ä¸‹è½½é¢„è®­ç»ƒæ¨¡å‹

ä½ å¯ä»¥ä» GitHub Releases ä¸‹è½½å·²ç»è®­ç»ƒå¥½çš„æ¨¡å‹ï¼Œæ— éœ€é‡æ–°è®­ç»ƒã€‚

#### æ–¹å¼ä¸€ï¼šè‡ªåŠ¨ä¸‹è½½ï¼ˆæ¨èï¼‰

è¿è¡Œè‡ªåŠ¨ä¸‹è½½è„šæœ¬ï¼š

```bash
python download_model.py
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- è·å–æœ€æ–°ç‰ˆæœ¬çš„æ¨¡å‹
- ä¸‹è½½å¹¶æ˜¾ç¤ºè¿›åº¦
- è‡ªåŠ¨è§£å‹åˆ°æ­£ç¡®çš„ç›®å½•
- éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ

#### æ–¹å¼äºŒï¼šæ‰‹åŠ¨ä¸‹è½½

1. è®¿é—® [Releases é¡µé¢](https://github.com/wilinz/slider_captcha_trajectory_gen/releases)
2. ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„æ¨¡å‹æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯ `final_model.zip` æˆ–ç±»ä¼¼åç§°ï¼‰
3. è§£å‹åˆ°é¡¹ç›®çš„ `models` ç›®å½•ä¸‹

è§£å‹åçš„ç›®å½•ç»“æ„åº”è¯¥æ˜¯ï¼š
```
slider_trajectory_gen/
â””â”€â”€ models/
    â””â”€â”€ final_model/
        â”œâ”€â”€ adapter_config.json
        â”œâ”€â”€ adapter_model.safetensors
        â”œâ”€â”€ tokenizer_config.json
        â””â”€â”€ ...
```

> ğŸ’¡ **æç¤º**: ä¸‹è½½é¢„è®­ç»ƒæ¨¡å‹åå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œè·³è¿‡è®­ç»ƒæ­¥éª¤ã€‚

### 4. ï¼ˆå¯é€‰ï¼‰å‡†å¤‡è®­ç»ƒæ•°æ®

å¦‚æœéœ€è¦é‡æ–°è®­ç»ƒæ¨¡å‹ï¼Œè¯·å‡†å¤‡ `training_data.jsonl` æ–‡ä»¶ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

```json
{"text": "<|input|>distance:60,canvas:280<|output|>0,0,0;5,-2,30;12,-3,28;...<|end|>"}
{"text": "<|input|>distance:120,canvas:280<|output|>0,0,0;8,-1,25;15,-2,32;...<|end|>"}
```

## ğŸ“ æ•°æ®æ ‡æ³¨ä¸å¤„ç†

### ä¸‹è½½ç¤ºä¾‹æ•°æ®é›†

å¦‚æœæƒ³å¿«é€Ÿå¼€å§‹ï¼Œå¯ä»¥ä¸‹è½½å·²å‡†å¤‡å¥½çš„æ•°æ®é›†ï¼š

ğŸ“¦ **[ä¸‹è½½æ•°æ®é›† (captcha_dataset.zip)](https://github.com/wilinz/slider_captcha_trajectory_gen/releases/download/v1.0.0/captcha_dataset.zip)**

æ•°æ®é›†ä¿¡æ¯ï¼š
- ğŸ“Š æ€»è®¡ï¼š5000 æ¡éªŒè¯ç æ•°æ®
- âœ… å·²æ ‡æ³¨ï¼š1246 æ¡ï¼ˆå¯ç›´æ¥ç”¨äºè®­ç»ƒï¼‰ï¼Œå·²è½¬æ¢åˆ° training_data.jsonl
- ğŸ“ åŒ…å«å®Œæ•´çš„å›¾ç‰‡å’Œæ ‡æ³¨æ•°æ®

ä¸‹è½½åè§£å‹åˆ°é¡¹ç›®ç›®å½•å³å¯ä½¿ç”¨ã€‚

### è‡ªè¡Œæ ‡æ³¨æ•°æ®

å¦‚æœéœ€è¦è‡ªå·±åˆ›å»ºè®­ç»ƒæ•°æ®é›†ï¼Œé¡¹ç›®æä¾›äº† Flutter æ ‡æ³¨å·¥å…·ã€‚

> ğŸ’¡ **é‡è¦æç¤º**ï¼šå»ºè®®ä½¿ç”¨ **V1 æ ‡æ³¨å™¨**ï¼ˆç¬¦åˆçœŸå®éªŒè¯ç é€»è¾‘ï¼‰ï¼ŒV2 ä¸ºå®éªŒå·¥å…·ã€‚

**æ ‡æ³¨å·¥å…·åŸºäº Flutter 3.35.0 å¼€å‘ï¼Œå»ºè®®ä½¿ç”¨ `fvm` ç®¡ç† Flutter ç‰ˆæœ¬**ã€‚

> ğŸ“– **å‚è€ƒ**: [fvm å®‰è£…å‘å¯¼](https://fvm.app/documentation/getting-started/installation)

### å¿«é€Ÿå¼€å§‹

```bash
# 1. å‡†å¤‡æ•°æ®é›†ç›®å½•
mkdir -p captcha_dataset/images
mkdir -p captcha_dataset/metadata

# 2. å°†éªŒè¯ç å›¾ç‰‡æ”¾å…¥ images ç›®å½•
#    å‘½åæ ¼å¼: {id}_big.png, {id}_small.png

# 3. è¿è¡Œæ ‡æ³¨å·¥å…·
cd captcha_annotator_flutter
flutter pub get
flutter run

# 4. è½¬æ¢ä¸ºè®­ç»ƒæ•°æ®
python convert_to_jsonl.py \
    --input_dir captcha_dataset/metadata \
    --output_file training_data.jsonl
```

### è¯¦ç»†æ–‡æ¡£

å®Œæ•´çš„æ•°æ®æ ‡æ³¨æŒ‡å—è¯·å‚è€ƒï¼š

ğŸ“– **[æ•°æ®æ ‡æ³¨ä¸å¤„ç†æŒ‡å—](DATA_ANNOTATION.md)** - åŒ…å«è¯¦ç»†çš„æ ‡æ³¨æµç¨‹ã€æ•°æ®æ ¼å¼è¯´æ˜ã€è´¨é‡æ§åˆ¶æŠ€å·§ç­‰

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### è®­ç»ƒæ¨¡å‹

```bash
python train_lora.py
```

è®­ç»ƒé…ç½®ï¼š
- åŸºç¡€æ¨¡å‹ï¼šQwen/Qwen2.5-0.5B-Instruct
- LoRA rank: 16
- è®­ç»ƒè½®æ•°ï¼š10 epochs
- Batch size: 4ï¼ˆæ¢¯åº¦ç´¯ç§¯æ­¥æ•°: 4ï¼‰
- å­¦ä¹ ç‡ï¼š2e-4

è®­ç»ƒå®Œæˆåï¼Œæ¨¡å‹å°†ä¿å­˜åˆ° `models/final_model/` ç›®å½•ã€‚

### ç”Ÿæˆè½¨è¿¹

```python
from llm_generator import LLMTrajectoryGenerator

# åˆå§‹åŒ–ç”Ÿæˆå™¨
generator = LLMTrajectoryGenerator(
    model_path="models/final_model",  # æ¨¡å‹è·¯å¾„
    device="auto"  # è‡ªåŠ¨é€‰æ‹©è®¾å¤‡ï¼ˆcuda/mps/cpuï¼‰
)

# ç”Ÿæˆè½¨è¿¹
tracks = generator.generate(
    target_distance=60,      # ç›®æ ‡è·ç¦»ï¼ˆæ»‘å—éœ€è¦ç§»åŠ¨çš„åƒç´ æ•°ï¼‰
    canvas_length=280,       # ç”»å¸ƒé•¿åº¦
    temperature=0.8,         # é‡‡æ ·æ¸©åº¦ï¼ˆ0.0-1.0ï¼Œè¶Šé«˜è¶Šéšæœºï¼‰
    top_p=0.95              # nucleus sampling å‚æ•°
)

# è¾“å‡ºæ ¼å¼ï¼š
# [
#   {'a': 0, 'b': 0, 'c': 0},       # xåæ ‡, yåç§», æ—¶é—´é—´éš”(ms)
#   {'a': 5, 'b': -2, 'c': 30},
#   {'a': 12, 'b': -3, 'c': 28},
#   ...
# ]
print(tracks)
```

### æµ‹è¯•ç”Ÿæˆå™¨

```bash
python llm_generator.py
```

### å¯è§†åŒ–å·¥å…·

åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `tools/slider-tool.html`ï¼Œå¯ä»¥å¯è§†åŒ–æµ‹è¯•ç”Ÿæˆçš„è½¨è¿¹ã€‚

## ğŸ“Š è½¨è¿¹æ•°æ®æ ¼å¼

ç”Ÿæˆçš„è½¨è¿¹æ˜¯ä¸€ä¸ªåŒ…å«å¤šä¸ªè½¨è¿¹ç‚¹çš„åˆ—è¡¨ï¼Œæ¯ä¸ªç‚¹åŒ…å«ï¼š

- `a` (int): X åæ ‡ï¼ˆæ¨ªå‘ç§»åŠ¨è·ç¦»ï¼Œåƒç´ ï¼‰
- `b` (int): Y åæ ‡åç§»ï¼ˆçºµå‘æŠ–åŠ¨ï¼Œåƒç´ ï¼ŒèŒƒå›´ -30 åˆ° 5ï¼‰
- `c` (int): æ—¶é—´é—´éš”ï¼ˆè·ç¦»ä¸Šä¸€ä¸ªç‚¹çš„æ—¶é—´ï¼Œæ¯«ç§’ï¼‰

ç¤ºä¾‹ï¼š
```json
[
  {"a": 0, "b": 0, "c": 0},
  {"a": 5, "b": -2, "c": 30},
  {"a": 12, "b": -3, "c": 28},
  {"a": 20, "b": -1, "c": 35},
  {"a": 60, "b": 0, "c": 40}
]
```

## âš™ï¸ å‚æ•°è¯´æ˜

### LLMTrajectoryGenerator.generate()

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `target_distance` | int | - | ç›®æ ‡è·ç¦»ï¼ˆå¿…éœ€ï¼‰ï¼Œæ»‘å—éœ€è¦ç§»åŠ¨çš„åƒç´ æ•° |
| `canvas_length` | int | 280 | ç”»å¸ƒé•¿åº¦ |
| `temperature` | float | 0.8 | é‡‡æ ·æ¸©åº¦ï¼ŒèŒƒå›´ 0.0-1.0ã€‚å€¼è¶Šé«˜ç”Ÿæˆç»“æœè¶Šéšæœºå¤šæ · |
| `top_p` | float | 0.95 | Nucleus sampling å‚æ•°ï¼Œæ§åˆ¶é‡‡æ ·çš„å¤šæ ·æ€§ |

## ğŸ¯ æ¨¡å‹è®­ç»ƒç»†èŠ‚

### LoRA é…ç½®

- **Rank (r)**: 16
- **Alpha**: 32
- **Target Modules**:
  - Attention å±‚: `q_proj`, `k_proj`, `v_proj`, `o_proj`
  - FFN å±‚: `gate_proj`, `up_proj`, `down_proj`
- **Dropout**: 0.05

### è®­ç»ƒå‚æ•°

- **è®­ç»ƒè½®æ•°**: 10 epochs
- **Batch Size**: 4 (per device)
- **æ¢¯åº¦ç´¯ç§¯æ­¥æ•°**: 4
- **æœ‰æ•ˆ Batch Size**: 16
- **å­¦ä¹ ç‡**: 2e-4
- **Warmup Steps**: 100
- **è®­ç»ƒé›†/éªŒè¯é›†**: 90% / 10%

## ğŸ’¡ æŠ€æœ¯æ ˆ

- **åŸºç¡€æ¨¡å‹**: [Qwen2.5-0.5B-Instruct](https://huggingface.co/Qwen/Qwen2.5-0.5B-Instruct) (é˜¿é‡Œé€šä¹‰åƒé—®)
- **å¾®è°ƒæŠ€æœ¯**: LoRA (Low-Rank Adaptation)
- **æ¡†æ¶**:
  - PyTorch
  - Hugging Face Transformers
  - PEFT (Parameter-Efficient Fine-Tuning)

## ğŸ” æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **GPU åŠ é€Ÿ**: ä½¿ç”¨ CUDA GPU å¯å¤§å¹…æå‡è®­ç»ƒå’Œæ¨ç†é€Ÿåº¦
2. **Apple Silicon**: MPS åç«¯æ”¯æŒåœ¨ M1/M2/M3 èŠ¯ç‰‡ä¸ŠåŠ é€Ÿ
3. **æ‰¹é‡ç”Ÿæˆ**: ä¸€æ¬¡ç”Ÿæˆå¤šä¸ªè½¨è¿¹å¯æé«˜æ•ˆç‡
4. **æ¨¡å‹é‡åŒ–**: å¯ä½¿ç”¨ 8bit æˆ– 4bit é‡åŒ–å‡å°‘æ˜¾å­˜å ç”¨

## ğŸ“ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•è°ƒæ•´ç”Ÿæˆè½¨è¿¹çš„éšæœºæ€§ï¼Ÿ

A: é€šè¿‡è°ƒæ•´ `temperature` å‚æ•°ï¼š
- `temperature=0.5`: æ›´ä¿å®ˆï¼Œè½¨è¿¹æ›´ä¸€è‡´
- `temperature=0.8`: å¹³è¡¡ï¼ˆæ¨èï¼‰
- `temperature=1.0`: æ›´éšæœºï¼Œè½¨è¿¹æ›´å¤šæ ·

### Q: ç”Ÿæˆçš„è½¨è¿¹ä¸è‡ªç„¶æ€ä¹ˆåŠï¼Ÿ

A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. è®­ç»ƒæ•°æ®è´¨é‡æ˜¯å¦è¶³å¤Ÿå¥½
2. è®­ç»ƒè½®æ•°æ˜¯å¦å……è¶³
3. å°è¯•è°ƒæ•´ temperature å’Œ top_p å‚æ•°

### Q: å¯ä»¥åœ¨ CPU ä¸Šè¿è¡Œå—ï¼Ÿ

A: å¯ä»¥ï¼Œä½†é€Ÿåº¦è¾ƒæ…¢ã€‚æ¨èä½¿ç”¨ GPU æˆ– Apple Silicon (MPS)ã€‚

## ğŸ“„ è®¸å¯è¯

MIT

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“® è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ Issueã€‚

---

â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª Starï¼